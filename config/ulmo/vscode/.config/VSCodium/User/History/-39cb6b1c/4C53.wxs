<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Product Id="*" Name="Обробник ДРРП" Language="1058" Version="1.0.0" Manufacturer="GeoInfo" UpgradeCode="PUT-GUID-HERE">
    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate />
    <Icon Id="AppIcon.ico" SourceFile="main/main.ico"/>
    <Property Id="ARPPRODUCTICON" Value="AppIcon.ico" />
    <Feature Id="ProductFeature" Title="MyApp" Level="1" AllowAdvertise="yes" Display="expand">

      <ComponentGroupRef Id="MainFiles" />
      <ComponentRef Id="DesktopShortcutComponent" />
    </Feature>
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="MyApp">
          <Component Id="MainEXE" Guid="*">
            <File Id="MainExe" Source="main\main.exe" KeyPath="yes" />
          </Component>

          <Directory Id="INTERNALFOLDER" Name="_internal">
            <Component Id="InternalFiles" Guid="*">
              <File Id="InternalFile1" Source="main\_internal\internal.dll" KeyPath="yes" />
            </Component>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder">
        <Component Id="DesktopShortcutComponent" Guid="*">
          <Shortcut Id="desktopShortcut"
                    Name="MyApp"
                    Target="[INSTALLFOLDER]main.exe"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="AppIcon.ico"
                    Advertise="yes"/>
          <RemoveFolder Id="DesktopFolder" On="uninstall"/>
          <RegistryValue Root="HKCU" Key="Software\MyApp" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
        </Component>
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="MainFiles">
      <ComponentRef Id="MainEXE" />
      <ComponentRef Id="InternalFiles" />
    </ComponentGroup>
  </Fragment>
</Wix>
